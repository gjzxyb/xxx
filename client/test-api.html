<!DOCTYPE html>
<html>
<head>
  <title>API Test</title>
  <script src="js/api.js"></script>
</head>
<body>
  <h1>API Diagnostic Test</h1>
  <div id="results"></div>

  <script>
    // Get projectId from URL
    const urlParams = new URLSearchParams(window.location.search);
    const projectId = urlParams.get('projectId');

    document.getElementById('results').innerHTML += '<p>ProjectId: ' + projectId + '</p>';
    document.getElementById('results').innerHTML += '<p>Token: ' + (getToken() ? 'Exists' : 'Missing') + '</p>';

    // Test API calls that admin.html makes on load
    async function testAPIs() {
      try {
        // Test 1: Get registration status
        document.getElementById('results').innerHTML += '<h3>Test 1: /auth/registration-status</h3>';
        const regStatus = await fetch('/api/auth/registration-status');
        const regData = await regStatus.json();
        document.getElementById('results').innerHTML += '<pre>' + JSON.stringify(regData, null, 2) + '</pre>';

        // Test 2: Get selections status
        document.getElementById('results').innerHTML += '<h3>Test 2: /selections/status?projectId=' + projectId + '</h3>';
        const selStatus = await api.selections.getStatus();
        document.getElementById('results').innerHTML += '<pre>' + JSON.stringify(selStatus, null, 2) + '</pre>';

        // Test 3: Get admin config
        document.getElementById('results').innerHTML += '<h3>Test 3: /admin/config?projectId=' + projectId + '</h3>';
        const config = await api.admin.getConfig();
        document.getElementById('results').innerHTML += '<pre>' + JSON.stringify(config, null, 2) + '</pre>';

      } catch (err) {
        document.getElementById('results').innerHTML += '<p style="color:red">Error: ' + err.message + '</p>';
      }
    }

    if (isLoggedIn()) {
      testAPIs();
    } else {
      document.getElementById('results').innerHTML += '<p style="color:red">Not logged in!</p>';
    }
  </script>
</body>
</html>
